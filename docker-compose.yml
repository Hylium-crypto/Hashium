# Hashium Full Stack Deployment

services:
  backend:
    build: ./backend
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=production
      - DATABASE_URL=file:/app/data/hashium.db
      - JWT_SECRET=${JWT_SECRET}
      - JWT_REFRESH_SECRET=${JWT_REFRESH_SECRET}
      - CORS_ORIGIN=http://localhost
      - HSMIUM_RPC_URL=http://hashiumd:9332
      - HSMIUM_RPC_USER=${RPC_USER}
      - HSMIUM_RPC_PASS=${RPC_PASS}
    volumes:
      - backend-data:/app/data
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "node", "-e", "require('http').get('http://localhost:3001/health', (r) => process.exit(r.statusCode === 200 ? 0 : 1)).on('error', () => process.exit(1))" ]
      interval: 30s
      timeout: 10s
      retries: 3

  website:
    build: ./website
    ports:
      - "80:80"
    depends_on:
      - backend
    restart: unless-stopped
  # Optional: Hashium node
  # hashiumd:
  #   image: hashium/hashiumd:latest
  #   ports:
  #     - "9333:9333"  # P2P
  #     - "9332:9332"  # RPC (internal only)
  #   volumes:
  #     - hashium-data:/root/.hashium
  #   command: >
  #     hashiumd
  #     -server=1
  #     -rpcuser=${RPC_USER}
  #     -rpcpassword=${RPC_PASS}
  #     -rpcallowip=172.0.0.0/8

volumes:
  backend-data: # hashium-data:
